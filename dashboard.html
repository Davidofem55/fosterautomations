<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med Spa Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 min-h-screen">
    
    <!-- Header -->
    <div class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                        Med Spa Management
                    </h1>
                    <p class="text-gray-600 mt-1">Complete Lead Tracking System</p>
                </div>
                <div class="flex items-center gap-4">
                    <select id="timeRange" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="7">Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                    </select>
                    <button onclick="refreshData()" class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="bg-white shadow border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex gap-8">
                <button onclick="showTab('dashboard')" id="tab-dashboard" class="flex items-center gap-2 px-4 py-4 border-b-2 border-purple-600 text-purple-600">
                    <i data-lucide="trending-up" class="w-5 h-5"></i>
                    Dashboard
                </button>
                <button onclick="showTab('leads')" id="tab-leads" class="flex items-center gap-2 px-4 py-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    Leads
                </button>
                <button onclick="showTab('activity')" id="tab-activity" class="flex items-center gap-2 px-4 py-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900">
                    <i data-lucide="activity" class="w-5 h-5"></i>
                    Activity
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Dashboard View -->
        <div id="dashboard-view">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4" style="border-left-color: #667eea">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-sm font-medium mb-1">Total Leads</p>
                            <h3 class="text-3xl font-bold mb-1" style="color: #667eea" id="stat-total">0</h3>
                            <p class="text-sm text-gray-600">All time</p>
                        </div>
                        <div class="p-4 rounded-full" style="background-color: #667eea15">
                            <i data-lucide="users" class="w-8 h-8" style="color: #667eea"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4" style="border-left-color: #f59e0b">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-sm font-medium mb-1">New Leads</p>
                            <h3 class="text-3xl font-bold mb-1" style="color: #f59e0b" id="stat-new">0</h3>
                            <p class="text-sm text-gray-600">Awaiting contact</p>
                        </div>
                        <div class="p-4 rounded-full" style="background-color: #f59e0b15">
                            <i data-lucide="clock" class="w-8 h-8" style="color: #f59e0b"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4" style="border-left-color: #10b981">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-sm font-medium mb-1">Booked</p>
                            <h3 class="text-3xl font-bold mb-1" style="color: #10b981" id="stat-booked">0</h3>
                            <p class="text-sm text-gray-600">Consultations</p>
                        </div>
                        <div class="p-4 rounded-full" style="background-color: #10b98115">
                            <i data-lucide="check-circle" class="w-8 h-8" style="color: #10b981"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4" style="border-left-color: #8b5cf6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-sm font-medium mb-1">Conversion</p>
                            <h3 class="text-3xl font-bold mb-1" style="color: #8b5cf6" id="stat-conversion">0%</h3>
                            <p class="text-sm text-gray-600" id="stat-response">Avg response: 0h</p>
                        </div>
                        <div class="p-4 rounded-full" style="background-color: #8b5cf615">
                            <i data-lucide="trending-up" class="w-8 h-8" style="color: #8b5cf6"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Placeholder -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Leads</h3>
                    <div id="recent-leads-list" class="space-y-3">
                        <!-- Recent leads will be inserted here -->
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Treatment Breakdown</h3>
                    <div id="treatment-breakdown" class="space-y-2">
                        <!-- Treatment stats will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Status Pipeline -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Lead Status Pipeline</h3>
                <div id="status-pipeline" class="grid grid-cols-5 gap-4">
                    <!-- Status counts will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Leads View -->
        <div id="leads-view" class="hidden">
            <!-- Search and Filter -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                        <input
                            type="text"
                            id="search-input"
                            placeholder="Search by name, email, or phone..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                            oninput="filterLeads()"
                        />
                    </div>
                    
                    <select id="status-filter" onchange="filterLeads()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="all">All Statuses</option>
                        <option value="New">New</option>
                        <option value="Contacted">Contacted</option>
                        <option value="Qualified">Qualified</option>
                        <option value="Booked">Booked</option>
                        <option value="Lost">Lost</option>
                    </select>
                    
                    <button onclick="exportData()" class="flex items-center justify-center gap-2 px-4 py-2 gradient-bg text-white rounded-lg hover:shadow-lg transition-all">
                        <i data-lucide="download" class="w-5 h-5"></i>
                        Export CSV
                    </button>
                </div>
            </div>

            <!-- Leads Table -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="gradient-bg text-white">
                            <tr>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Contact</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Treatment</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Availability</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">Date</th>
                            </tr>
                        </thead>
                        <tbody id="leads-table-body" class="divide-y divide-gray-200">
                            <!-- Leads will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Activity View -->
        <div id="activity-view" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-6">Recent Activity</h3>
                <div id="activity-list" class="space-y-4">
                    <div class="text-center py-12">
                        <i data-lucide="bell" class="w-12 h-12 mx-auto text-gray-300 mb-4"></i>
                        <p class="text-gray-500">No recent activity</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
       async function loadRealData() {
    try {
        // Fetch from Airtable API
        const response = await fetch('https://api.airtable.com/v0/appYxaLzOMQSrgHQu/tblR4uvSyfcezdh9q', {
            headers: {
                'Authorization': 'patk9OGp8mQspu3xJ.81a1ad175ccbbf9e24d5e4f795dfabef47184123712e34e46d7714017c08c2d9'
            }
        });
        
        const data = await response.json();
        allLeads = data.records.map(record => ({
            id: record.id,
            name: record.fields.Name,
            email: record.fields.Email,
            phone: record.fields.Phone,
            treatment: record.fields.Treatment,
            status: record.fields.Status,
            availability: record.fields.Availability,
            message: record.fields.Message,
            source: record.fields['Lead Source'],
            created: record.fields.Created
        }));
        
        filteredLeads = [...allLeads];
        updateStats();
        updateLeadsTable();
    } catch (error) {
        console.error('Error loading data:', error);
        generateSampleData(); // Fallback to sample data
    }
}
    </script>
</body>

</html>
